#!/bin/sh

# amixer sets return the current Master via stddout

if [[ $1 == 'up' ]]; then
    amixermaster=$(amixer set Master '1%+')
fi

if [[ $1 == 'down' ]]; then
    amixermaster=$(amixer set Master '1%-')
fi

if [[ $1 == 'toggle' ]]; then
    # amixer seems to fail to unmute correctly sometimes, this seems to be more
    # reliable
    amixermaster=$(amixer -D pulse set Master 'toggle')
    # pactl set-sink-mute 0 toggle
    # amixermaster=$(amixer get Master)
fi

vol1=$(grep 'Front Left:' <<< "$amixermaster" | perl -e "my \$string = <>;print \"Mu\" if \$string =~ /off/;\$string =~ s/\[(\d+)%\]// if \$string =~ /\[on\]/;print \$1;")
vol2=$(grep 'Mono:' <<< "$amixermaster" | perl -e "my \$string = <>;print \"Mu\" if \$string =~ /off/;\$string =~ s/\[(\d+)%\]// if \$string =~ /\[on\]/;print \$1;")

echo $vol1$vol2 > /tmp/vol
